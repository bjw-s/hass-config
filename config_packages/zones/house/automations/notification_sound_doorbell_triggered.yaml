---
id: notifications_sound_doorbell_triggered
alias: Notifications - Sound Doorbell triggered

mode: single
max_exceeded: silent

trigger:
  platform: state
  entity_id: binary_sensor.doorbell_visitor
  # from: "off"
  to: "on"

variables:
  external_url: "{{ states('sensor.system_url_external') }}"
  internal_url: "{{ states('sensor.system_url_internal_direct') }}"
  # Rate limit the automation to once per 30 seconds
  cooldown: 10

action:
  - alias: "Play doorbell on ESP speakers"
    service: media_player.play_media
    entity_id:
      - media_player.attic_office_speaker
      - media_player.upstairs_office_speaker
    data:
      media_content_id: "{{internal_url}}/local/audio/doorbell.mp3"
      media_content_type: music

  - service: media_player.play_media
    data:
      entity_id:
        - media_player.living_room
        - media_player.kitchen
      media_content_id: "{{external_url}}/local/audio/doorbell.mp3"
      media_content_type: music
      extra:
        volume: 20
        play_on_bonded: true

  - delay:
      seconds: "{{ cooldown }}"
